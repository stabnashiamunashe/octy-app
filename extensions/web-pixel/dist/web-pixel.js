(()=>{var M=Object.create;var U=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var $=(c,e)=>()=>(c&&(e=c(c=0)),e);var S=(c,e)=>()=>(e||c((e={exports:{}}).exports,e),e.exports);var F=(c,e,n,p)=>{if(e&&typeof e=="object"||typeof e=="function")for(let f of X(e))!A.call(c,f)&&f!==n&&U(c,f,{get:()=>e[f],enumerable:!(p=V(e,f))||p.enumerable});return c};var H=(c,e,n)=>(n=c!=null?M(Y(c)):{},F(e||!c||!c.__esModule?U(n,"default",{value:c,enumerable:!0}):n,c));var _=(c,e,n)=>new Promise((p,f)=>{var d=y=>{try{g(n.next(y))}catch(m){f(m)}},s=y=>{try{g(n.throw(y))}catch(m){f(m)}},g=y=>y.done?p(y.value):Promise.resolve(y.value).then(d,s);g((n=n.apply(c,e)).next())});var R,b=$(()=>{R="WebPixel::Render"});var D,N=$(()=>{b();D=c=>shopify.extend(R,c)});var P=$(()=>{N()});var J=$(()=>{P()});var O=S((mt,E)=>{"use strict";var I="https://pod1.sonity.net/octy-shopify";E.exports={octyAppHost:I,createCustomerURI:I+"/api/customers/createupdate",createEventURI:I+"/api/hooks/events/create",createItemURI:I+"/api/hooks/items/create",updateItemURI:I+"/api/hooks/items/update",deleteItemURI:I+"/api/hooks/items/delete",getContentURI:I+"/api/content",getRecommendationsURI:I+"/api/recommendations",pixelURI:I+"/api/hooks/events/create"}});var w=S((lt,C)=>{"use strict";function z(){return`octy_customer_id-${"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)})}`}function G(c){return/^octy_customer_id-[a-f0-9]{8}-([a-f0-9]{4}-){3}[a-f0-9]{12}$/.test(c)}C.exports={generateOctyCustomerID:z,isValidOctyCustomerID:G}});var W=S((ut,L)=>{"use strict";var Q=O(),Z=w();function v(c,e,n,p){return _(this,null,function*(){try{let f,d=!1,s={};c==null?(f=Z.generateOctyCustomerID(),d=!0,s.fingerprint_id=e):f=c,n==null?n="":(s.shopify_customer_id=n,delete s.fingerprint_id);let g=yield fetch(`${Q.createCustomerURI}?shop=${p}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({octy_customer_id:f,shopify_customer_id:n,has_charged:!1,profile_data:s,platform_info:{},generated_new_id:d})});if(g.status===200||g.status===201)return yield g.text();throw console.log("Failed to create new Octy profile! Unable to track events or provide personalised experience during this session 1"),new Error("Server Error")}catch(f){throw new Error("Server Error")}})}var x;function tt(c){return _(this,null,function*(){let e=yield c.localStorage.getItem("octy_ica"),n=yield c.localStorage.getItem("octy_customer_id");e?x=new WebSocket(process.env.OCTY_WEBSOCKET_URL+n):(x=new WebSocket(process.env.OCTY_WEBSOCKET_URL+n),x.addEventListener("open",p=>{console.log("This is from Web Pixels"),console.log("WebSocket connection opened:",p)}),x.addEventListener("message",p=>{console.log("Message from server:",p.data);let f=JSON.parse(p.data);if(f.type==="coupon"){console.log("Received coupon code:",f.couponCode);let d=new CustomEvent("octy:gift_coupon",{detail:{octy_coupon_code:f.couponCode}});window.dispatchEvent(d)}}),x.addEventListener("error",p=>{console.error("WebSocket error:",p)}),x.addEventListener("close",p=>{_(this,null,function*(){yield c.localStorage.setItem("octy_ica",!1)})}))})}L.exports={createUpdateProfile:v,establishWebSocketConnection:tt}});var q=S(l=>{"use strict";J();var et=W(),u=O(),it=w();D(f=>_(l,[f],function*({analytics:c,browser:e,settings:n,init:p}){let d=p.data.customer,s=p.data.cart,g=(yield e.cookie.get("has_visited"))==="true";function y(){return _(this,null,function*(){return yield(yield fetch("https://pod1.sonity.net/octy-client-info/info")).json()})}let m=yield y();if(!g){let t=m.full_hash,i=new Date;i.setTime(i.getTime()+1*24*60*60*1e3);let o="expires="+i.toUTCString();yield e.cookie.set(`fingerprint_id=${t};`+o+";path=/");let r=null;d!==null&&(r=d.id);let a=!0;try{let h,T=yield e.localStorage.getItem("octy_customer_id");T!==null&&(a=!1,h=T.replace(/^"(.*)"$/,"$1"),it.isValidOctyCustomerID(h)||(h=null));let B=yield et.createUpdateProfile(h,t,r,n.accountID);yield e.localStorage.setItem("octy_customer_id",B.replace(/^"(.*)"$/,"$1"));let K=Date.now();yield e.localStorage.setItem("p_lst",K)}catch(h){console.error(h),a&&(yield e.localStorage.removeItem("octy_customer_id"))}let k=new Date;k.setTime(k.getTime()+1*24*60*60*1e3);let j="expires="+k.toUTCString();yield e.cookie.set("has_visited=true;"+j+";path=/")}c.subscribe("checkout_started",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};console.log(a),fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("cart_viewed",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("checkout_address_info_submitted",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};console.log(a),fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("checkout_completed",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("checkout_contact_info_submitted",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};console.log(a),fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("checkout_shipping_info_submitted",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("collection_viewed",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("page_viewed",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("payment_info_submitted",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("product_added_to_cart",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("product_removed_from_cart",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("product_viewed",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("search_submitted",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("page_scroll",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,customData:t.customData,context:t.context,octy_customer_id:o,client_data:m,shopify_customer_info:d,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",headers:{"x-shopify-shop-domain":n.accountID},body:JSON.stringify(a),keepalive:!0})})),c.subscribe("product_hover",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,customData:t.customData,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("product_quantity_changed",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,customData:t.customData,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",headers:{"x-shopify-shop-domain":n.accountID},body:JSON.stringify(a),keepalive:!0})})),c.subscribe("clicked",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};console.log(a),fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("form_submitted",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};console.log(a),fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("input_blurred",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};console.log(a),fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("input_changed",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};console.log(a),fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})})),c.subscribe("input_focused",t=>_(l,null,function*(){let i=yield e.localStorage.getItem("octy_customer_id"),o=null;i!=null&&(o=i.replace(/^"(.*)"$/,"$1"));let r=yield e.cookie.get("fingerprint_id"),a={id:t.id,name:t.name,fingerprint_id:r,timestamp:t.timestamp,clientId:t.clientId,data:t.data,context:t.context,octy_customer_id:o,shopify_customer_info:d,client_data:m,cart:s};console.log(a),fetch(`${u.pixelURI}?shop=${n.accountID}`,{method:"POST",body:JSON.stringify(a),keepalive:!0})}))}))});var It=H(q());})();
